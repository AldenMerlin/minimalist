<html>
  <head>
    <title>minimalist</title>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.5/angular.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.5/angular-resource.min.js"></script>
    <link rel="stylesheet" href="/vendor.css" />
  </head>

  <body>
    <h2>vanilla</h2>
    <mn-search placeholder="House" multiple></mn-search>
    <!-- <mn-select placeholder="House" multiple>
      <option value="{name: 'darlan'}" selected>Object</option>
      <option selected>Stark</option>
      <option>Lannister</option>
      <option>Targaryen</option>
    </mn-select>

    <mn-select placeholder="Test">
      <option>test1</option>
      <option selected>test2</option>
      <option>test3</option>
    </mn-select>

    <mn-button>set value</mn-button> -->


    <h2>angular</h2>
    <section ng-app="app" ng-controller="AppController as app">
      <mn-search houses placeholder="House" multiple ng-model='app.house'></mn-search>
      Model: {{ app.house }}
    </section>
    <!-- <mn-form ng-app="app" ng-controller="AppController as app">
      <mn-select placeholder="House" ng-model="app.house" multiple required>
        <option ng-repeat='house in app.houses' value="{{ house }}">{{ house }}</option>
      </mn-select>
      Model: {{ app.house }}

      <mn-button submit>submit</mn-button>
    </mn-form> -->

    <script src="/vendor.js"></script>
    <script>
      // vanilla
      // const select = document.querySelector('mn-select')
      // const button = document.querySelector('mn-button')

      // button.addEventListener('click', () => select.value = ['Stark', 'Lannister'])

      const search = document.querySelector('mn-search')

      search.addEventListener('search', (event) => {
        const params = new URLSearchParams()
        params.append('query', event.query)
        const houses = new Request(`http://localhost:4000/houses?${params}`) // the simple String or Request

        event.target
          .fetch(houses)
          .then(response => response.json())
          .then(setOptions)

        function setOptions(houses) {
          houses.forEach(house => {
            const option = document.createElement('option')
            option.textContent = house
            option.setAttribute('value', house.toLowerCase())
            event.target.appendChild(option)
          })
        }
      })


      // angular
      angular.module('app', ['ngResource', 'minimalist'])

      angular
        .module('app')
        .controller('AppController', AppController);

      function AppController() {
        this.houses = [
          'Stark',
          'Lannister',
          'Targaryen',
        ]

        // this.house = ['Stark', 'Lannister']
        // console.log(this.houses)
      }

      angular
        .module('app')
        .service('Houses', HousesService)

      HousesService.$inject = ['$resource']

      function HousesService($resource) {
        const service =  $resource('http://localhost:4000/houses') // the endpoint

        this.list = list

        function list(params = {}) {
          return service.query(params).$promise
        }
      }

      angular
        .module('app')
        .directive('houses', HousesSearchDirective)

      function HousesSearchDirective(Houses) {
        return {
          restrict: 'A',
          require: 'ngModel',
          link(scope, element, attributes) {
            element.bind('search', (event) => {
              const {query} = event

              event.target
                .fetch(() => Houses.list({query}))
                .then(setOptions)

              function setOptions(houses) {
                houses.forEach(house => {
                  const option = document.createElement('option')
                  option.textContent = house
                  option.setAttribute('value', house.toLowerCase())

                  event.target.appendChild(option)
                })
              }
            })
          }
        }
      }
    </script>
  </body>
</html>
